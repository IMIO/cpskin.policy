<?xml version="1.0"?>
<contentrules>
 <rule name="citizen-accept-event" title="Citizen : Accept event"
    description="Accept citizen contribution :
 - move event
 - publish event (hidden from navigation)
 - notify owner
"
    enabled="True" event="Products.CMFCore.interfaces.IActionSucceededEvent"
    stop-after="False">
  <conditions>
   <condition type="plone.conditions.PortalType">
    <property name="check_types">
     <element>Event</element>
    </property>
   </condition>
   <condition type="plone.conditions.WorkflowTransition">
    <property name="wf_transitions">
     <element>publish</element>
    </property>
   </condition>
  </conditions>
  <actions>
   <action type="plone.actions.Move">
    <property name="target_folder">/evenements</property>
   </action>
   <action type="plone.actions.RunScript">
    <property name="fail_on_script_not_found">True</property>
    <property name="restricted_traverse">False</property>
    <property name="parameters"/>
    <property name="script">publish_submission</property>
   </action>
   <action type="plone.actions.Mail">
    <property name="source"/>
    <property name="message">Your content has been posted at ${url}</property>
    <property name="subject">Publishing</property>
    <property name="recipients">${owner_emails}</property>
    <property name="exclude_actor">True</property>
   </action>
  </actions>
 </rule>
 <rule name="citizen-reject-event" title="Citizen : Reject event"
    description="Reject citizen contribution :
 - notify owner
"
    enabled="True" event="Products.CMFCore.interfaces.IActionSucceededEvent"
    stop-after="False">
  <conditions>
   <condition type="plone.conditions.PortalType">
    <property name="check_types">
     <element>Event</element>
    </property>
   </condition>
   <condition type="plone.conditions.WorkflowTransition">
    <property name="wf_transitions">
     <element>retract</element>
     <element>reject</element>
    </property>
   </condition>
  </conditions>
  <actions>
   <action type="plone.actions.Mail">
    <property name="source"/>
    <property name="message">Your content has been returned</property>
    <property name="subject">Returned</property>
    <property name="recipients">${owner_emails}</property>
    <property name="exclude_actor">True</property>
   </action>
  </actions>
 </rule>
 <assignment name="citizen-accept-event" bubbles="True" enabled="True" location="/Members"/>
 <assignment name="citizen-reject-event" bubbles="True" enabled="True" location="/Members"/>
</contentrules>
